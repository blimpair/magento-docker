version: '3.5'
services:
  ##Â PHP
  phplibs:
    image: ${REGISTRY}/${PROJECT_NAME}/phplibs:${VERSION}
    build:
      context: ../
      dockerfile: images/php/alpine/phplibs.Dockerfile
    command: "echo built"
  php7:
    image: ${REGISTRY}/${PROJECT_NAME}/php7:${VERSION}
    depends_on: 
      - phplibs
    build:
      context: ../
      dockerfile: images/php/alpine/Dockerfile
      args:
        BASE: ${REGISTRY}/${PROJECT_NAME}/phplibs:${VERSION}
        ENVIRONMENT: ${ENVIRONMENT}
        MAGENTO_PUBLIC_KEY: ${MAGENTO_PUBLIC_KEY}
        MAGENTO_PRIVATE_KEY: ${MAGENTO_PRIVATE_KEY}

  ## NGINX
  nginxbase:
    image: ${REGISTRY}/${PROJECT_NAME}/nginxbase:${VERSION}
    build:
      context: ../
      dockerfile: images/nginx/base.Dockerfile
    command: "echo built"
  nginx:
    image: ${REGISTRY}/${PROJECT_NAME}/nginx:${VERSION}
    depends_on: 
      - nginxbase
    build:
      context: ../
      dockerfile: images/nginx/Dockerfile
      args:
        BASE: ${REGISTRY}/${PROJECT_NAME}/nginxbase:${VERSION}
        ENVIRONMENT: ${ENVIRONMENT}

  ## MySQL
  mysql:
    image: '${REGISTRY}/${PROJECT_NAME}/mariadb:${VERSION}'
    build:
      context: ../
      dockerfile: images/mysql/Dockerfile
      args:
        ENVIRONMENT: ${ENVIRONMENT}
  
  ## REDIS
  redis:
    image: ${REGISTRY}/${PROJECT_NAME}/redis:${VERSION}
    build: 
      context: ../
      dockerfile: images/redis/Dockerfile